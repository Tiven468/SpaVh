{% extends 'usuarios/base.html' %}


{% block title %}Dashboard - Spa VH{% endblock %}

{% block extra_css %}
<style>
  body {
    background: #fdfdfd;
  }

  .dashboard-header {
    background: linear-gradient(135deg, #ffffff, #f7c59f);
    border-radius: 20px;
    padding: 2.5rem;
    text-align: center;
    margin-bottom: 3rem;
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    color: rgb(0, 0, 0);
  }

  .dashboard-header h1 {
    font-weight: 800;
  }

  .stat-card {
    background: #fff;
    border-radius: 20px;
    text-align: center;
    padding: 2rem 1rem;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.15);
  }

  .stat-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .chart-container {
    background: #fff;
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">

  <!-- Encabezado -->
  <div class="dashboard-header">
    <h1>âœ¨ Administracion Spa VH</h1>
    <p>Bienvenido al panel principal. Supervisa en tiempo real tus <strong>usuarios</strong>, <strong>citas</strong> y mÃ¡s.</p>
  </div>

  <!-- Tarjetas -->
  <div class="row g-4 mb-5">

    <div class="col-md-6 col-lg-3">
      <div class="stat-card">
        <i class="bi bi-people-fill stat-icon" style="color:#f7c59f;"></i>
        <h6>Usuarios</h6>
        <h2 class="fw-bold">{{ total_usuarios }}</h2>
      </div>
    </div>

    <div class="col-md-6 col-lg-3">
      <div class="stat-card">
        <i class="bi bi-calendar-check-fill stat-icon" style="color:#f7c59f;"></i>
        <h6>Citas</h6>
        <h2 class="fw-bold">{{ total_citas }}</h2>
      </div>
    </div>

    <div class="col-md-6 col-lg-3">
      <div class="stat-card">
        <i class="bi bi-chat-dots-fill stat-icon" style="color:#f7c59f;"></i>
        <h6>Mensajes</h6>
        <h2 class="fw-bold">{{ total_mensajes }}</h2>
      </div>
    </div>

    <div class="col-md-6 col-lg-3">
      <div class="stat-card">
        <i class="bi bi-bag-heart-fill stat-icon" style="color:#f7c59f;"></i>
        <h6>Servicios</h6>
        <h2 class="fw-bold">{{ total_servicios }}</h2>
      </div>
    </div>

  </div>

  <!-- SecciÃ³n de EstadÃ­sticas -->
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="chart-container">
        <h5 class="fw-bold mb-3">ðŸ“Š Estados de Citas</h5>
        <canvas id="citasChart"></canvas>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="chart-container">
        <h5 class="fw-bold mb-3">ðŸ‘¥ Usuarios y Mensajes</h5>
        <canvas id="usuariosChart"></canvas>
      </div>
    </div>
  </div>

</div>

<!-- InyecciÃ³n de datos JSON -->
{{ citas_data|json_script:"citas-data" }}
{{ usuarios_mensajes|json_script:"usuarios-mensajes" }}

<!-- Scripts Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Obtenemos los datos seguros desde JSON
  const citasData = JSON.parse(document.getElementById('citas-data').textContent);
  const usuariosMensajes = JSON.parse(document.getElementById('usuarios-mensajes').textContent);

  // GrÃ¡fico de Estados de Citas
  const citasChart = document.getElementById('citasChart').getContext('2d');
  new Chart(citasChart, {
    type: 'doughnut',
    data: {
      labels: ['Aceptadas', 'Pendientes', 'Canceladas'],
      datasets: [{
        data: [citasData.aceptadas, citasData.pendientes, citasData.canceladas],
        backgroundColor: ['#00fd87', '#fcff53', '#f83f3f'],
        hoverOffset: 6
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });

  // GrÃ¡fico de Usuarios vs Mensajes
  const usuariosChart = document.getElementById('usuariosChart').getContext('2d');
  new Chart(usuariosChart, {
    type: 'bar',
    data: {
      labels: ['Usuarios', 'Mensajes'],
      datasets: [{
        label: 'Cantidad',
        data: [usuariosMensajes.usuarios, usuariosMensajes.mensajes],
        backgroundColor: ['#f59caf', '#C79E42']
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>

{% endblock %}
